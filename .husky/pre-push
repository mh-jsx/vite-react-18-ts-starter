#!/bin/sh
# .husky/pre-push.sh

# Exit on error
set -e

# Get the current branch
current_branch=$(git symbolic-ref --short HEAD)

# Get the latest commit from the remote branch
latest_remote_commit=$(git rev-parse origin/$current_branch)

# Get the package.json version from the remote branch
remote_version=$(git show $latest_remote_commit:package.json | grep '"version":' | sed -E 's/.*"version": "(.*)".*/\1/')

# Get the package.json version from the current branch
current_version=$(grep '"version":' package.json | sed -E 's/.*"version": "(.*)".*/\1/')

# Compare the versions
if [ "$remote_version" = "$current_version" ]; then
  echo "Error: The package.json version has not been updated. Please update the version before pushing."
  exit 1
fi

echo "Version check passed. Proceeding with push."
